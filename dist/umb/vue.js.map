{"version":3,"file":"vue.js","sources":["../../src/utils/index.js","../../src/utils/array.js","../../src/observe/index.js","../../src/init/initState.js","../../src/init/index.js","../../src/index.js"],"sourcesContent":["/**\n * @file 工具函数\n */\n\n\n /**\n  * \n  * @param {*} data 当前数据是否是对象\n  */\nexport function isObject(data) {\n    return typeof data === 'object' && data !== null;\n}\n\nexport function def(data, key, value) {\n    Object.defineProperty(data, key, {\n        enumerable: false,\n        configurable: false,\n        value\n    });\n}","/**\n * @file 重写array的push、shift、unshift、 pop、 reverse等会使原数组发生变化的方法\n */\n\nlet oldArrayMethods = Array.prototype;\nexport let arrayMethods =  Object.create(oldArrayMethods);\n\n// 需要重写的方法\nlet methods = [\n    'push',\n    'pop',\n    'shift',\n    'unshift',\n    'sort',\n    'splice',\n    'reverse'\n];\n\nmethods.forEach(method => {\n    arrayMethods[method] = function (...args) {\n        // console.log('调用了push');\n        const result =  oldArrayMethods[method].apply(this, args); // 调用原生的数组方法\n        let inserted; // 用户当前插入的元素,插入的元素可能是对象或数组，需要进行监控\n        let ob = this.__ob__;\n        switch (method) {\n            case 'push':\n            case 'unshift':\n                inserted = args;\n                break;\n            case 'splice':\n                inserted = args.slice(2);\n            default:\n                break;\n        }\n        if (inserted) {\n            ob.observeArray(inserted);\n        }\n\n        return result;\n    };\n});\n","/**\n * @file 把data中的数据都使用objec.defineProperty重新定义 es5方法\n * @param {Objec} data\n */\n\nimport {isObject, def} from '../utils/index';\nimport {arrayMethods} from '../utils/array.js';\n\nclass Observer {\n    constructor(value) {\n        def(value, '__ob__', this); // 给每一个监控过的对象增加不可枚举属性‘__ob__’，方便为监控的对象增加方法，以及判断对象是否被监控\n\n        // 如果数据的层次过多，需要递归的去解析对象中的属性，依次增加set和get方法\n        if (Array.isArray(value)) {\n            // 如果是数组，不对索引进行监控，因为会导致性能问题\n            // 前端开发中很少会操作数组的索引，而是去操作push、shift、unshift\n            value.__proto__ = arrayMethods;\n\n            // 如果数组中的item是对象再进行监控\n            this.observeArray(value);\n\n        } else {\n            // 对对象进行监控\n            this.walk(value);\n        }\n    }\n\n    observeArray(value) {\n        for (let i = 0; i < value.length; i++) {\n            observe(value[i]);\n        }\n\n    }\n\n    walk(data) {\n        let keys = Object.keys(data);\n        keys.forEach(key => {\n            defineReactive(data, key, data[key]);\n        });\n    }\n}\n\nfunction defineReactive(data, key, value) {\n    observe(value); // 递归实现深度检测\n    Object.defineProperty(data, key, {\n        get() {\n            return value;\n        },\n        set(newValue) {\n            if (newValue === value) {\n                return;\n            }\n            observe(newValue); // 继续劫持用户设置的值，因为有可能用户设置的值是一个对象\n            // console.log('值发生了变化')\n            value = newValue;\n        }\n    });\n\n}\n\n\n\n // object.defineProperty不能兼容ie8 及以下 vue2 无法兼容ie8版本\nexport function observe(data) {\n    let isObj = isObject(data);\n    if (!isObj) {\n        return;\n    };\n    return new Observer(data); // 用来观测数据\n}\n","/**\n *@file vue初始化状态\n * @param {Object} vm  实例化对象\n */\n\nimport {observe} from '../observe/index';\n\nexport function initState(vm) {\n    const opts = vm.$options;\n    // vue的数据来源 属性 方法 数据 计算属性 watch\n    if (opts.props) {\n        initProps(vm);\n    }\n\n    if (opts.methods) {\n        initMethods(vm);\n    }\n\n    if (opts.data) {\n        initData(vm);\n    }\n\n    if (opts.computed) {\n        initComputed(vm);\n    }\n\n    if (opts.watch) {\n        initWatch(vm);\n    }\n}\n\nfunction initProps() {}\n\nfunction initMethods() {}\n\nfunction initData(vm) {\n    // 数据初始化工作\n    let data = vm.$options.data; // 用户传递的data\n    // 用户传递可能是Object、function我们最终需要的是Object,并需要保证用户在data中操作时的this指向实例\n    data = typeof data === 'function' ? data.call(vm) : data;\n\n    // 为了用户也能够拿到数据增加一个属性_data\n    vm._data = data;\n\n    // 对象劫持 用户改变了数据，我希望可以得到通知，根据用户的修改进行一些操作，例如刷新页面\n    // MVVM模式 数据变化可以驱动视图变化\n\n    // Object.defineProperty () 给属性增加get方法和set方法\n    observe(data);  // 响应式原理\n\n}\n\nfunction initComputed() {}\n\nfunction initWatch() {}","/**\n* @file 在Vue原型上添加一个_init方法\n*/\n\nimport {initState} from './initState';\n\nexport function initMixin(Vue) {\n    // 初始化流程\n    Vue.prototype._init = function (options) {\n        // 数据劫持\n        const vm = this; // vue中使用this.$options指代的是用户传递的属性\n        vm.$options = options;\n        \n        // 初始化状态\n        initState(vm); // 分割代码\n    };\n}","/**\n * @file Vue的核心代码，只是Vue的一个声明\n*/\n\nimport{initMixin} from './init/index';\n\n/**\n* \n* @param {Object} options // 实例对象\n*/\nfunction Vue(options) {\n\n    // 进行Vue的初始化操作\n    this._init(options);\n}\n\n// 通过引入文件的方式，给Vue原型上添加方法\ninitMixin(Vue);\n\nexport default Vue;\n"],"names":["isObject","data","def","key","value","Object","defineProperty","enumerable","configurable","oldArrayMethods","Array","prototype","arrayMethods","create","methods","forEach","method","args","result","apply","inserted","ob","__ob__","slice","observeArray","Observer","isArray","__proto__","walk","i","length","observe","keys","defineReactive","get","set","newValue","isObj","initState","vm","opts","$options","props","initData","computed","watch","call","_data","initMixin","Vue","_init","options"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAA;EACA;EACA;;EAGC;EACD;EACA;EACA;EACO,SAASA,QAAT,CAAkBC,IAAlB,EAAwB;EAC3B,SAAO,QAAOA,IAAP,MAAgB,QAAhB,IAA4BA,IAAI,KAAK,IAA5C;EACH;EAEM,SAASC,GAAT,CAAaD,IAAb,EAAmBE,GAAnB,EAAwBC,KAAxB,EAA+B;EAClCC,EAAAA,MAAM,CAACC,cAAP,CAAsBL,IAAtB,EAA4BE,GAA5B,EAAiC;EAC7BI,IAAAA,UAAU,EAAE,KADiB;EAE7BC,IAAAA,YAAY,EAAE,KAFe;EAG7BJ,IAAAA,KAAK,EAALA;EAH6B,GAAjC;EAKH;;ECnBD;EACA;EACA;EAEA,IAAIK,eAAe,GAAGC,KAAK,CAACC,SAA5B;EACO,IAAIC,YAAY,GAAIP,MAAM,CAACQ,MAAP,CAAcJ,eAAd,CAApB;;EAGP,IAAIK,OAAO,GAAG,CACV,MADU,EAEV,KAFU,EAGV,OAHU,EAIV,SAJU,EAKV,MALU,EAMV,QANU,EAOV,SAPU,CAAd;EAUAA,OAAO,CAACC,OAAR,CAAgB,UAAAC,MAAM,EAAI;EACtBJ,EAAAA,YAAY,CAACI,MAAD,CAAZ,GAAuB,YAAmB;EAAA,sCAANC,IAAM;EAANA,MAAAA,IAAM;EAAA;;EACtC;EACA,QAAMC,MAAM,GAAIT,eAAe,CAACO,MAAD,CAAf,CAAwBG,KAAxB,CAA8B,IAA9B,EAAoCF,IAApC,CAAhB,CAFsC;;EAGtC,QAAIG,QAAJ,CAHsC;;EAItC,QAAIC,EAAE,GAAG,KAAKC,MAAd;;EACA,YAAQN,MAAR;EACI,WAAK,MAAL;EACA,WAAK,SAAL;EACII,QAAAA,QAAQ,GAAGH,IAAX;EACA;;EACJ,WAAK,QAAL;EACIG,QAAAA,QAAQ,GAAGH,IAAI,CAACM,KAAL,CAAW,CAAX,CAAX;EANR;;EAUA,QAAIH,QAAJ,EAAc;EACVC,MAAAA,EAAE,CAACG,YAAH,CAAgBJ,QAAhB;EACH;;EAED,WAAOF,MAAP;EACH,GApBD;EAqBH,CAtBD;;MCVMO;EACF,oBAAYrB,KAAZ,EAAmB;EAAA;;EACfF,IAAAA,GAAG,CAACE,KAAD,EAAQ,QAAR,EAAkB,IAAlB,CAAH,CADe;EAGf;;EACA,QAAIM,KAAK,CAACgB,OAAN,CAActB,KAAd,CAAJ,EAA0B;EACtB;EACA;EACAA,MAAAA,KAAK,CAACuB,SAAN,GAAkBf,YAAlB,CAHsB;;EAMtB,WAAKY,YAAL,CAAkBpB,KAAlB;EAEH,KARD,MAQO;EACH;EACA,WAAKwB,IAAL,CAAUxB,KAAV;EACH;EACJ;;;;mCAEYA,OAAO;EAChB,WAAK,IAAIyB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGzB,KAAK,CAAC0B,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;EACnCE,QAAAA,OAAO,CAAC3B,KAAK,CAACyB,CAAD,CAAN,CAAP;EACH;EAEJ;;;2BAEI5B,MAAM;EACP,UAAI+B,IAAI,GAAG3B,MAAM,CAAC2B,IAAP,CAAY/B,IAAZ,CAAX;EACA+B,MAAAA,IAAI,CAACjB,OAAL,CAAa,UAAAZ,GAAG,EAAI;EAChB8B,QAAAA,cAAc,CAAChC,IAAD,EAAOE,GAAP,EAAYF,IAAI,CAACE,GAAD,CAAhB,CAAd;EACH,OAFD;EAGH;;;;;;EAGL,SAAS8B,cAAT,CAAwBhC,IAAxB,EAA8BE,GAA9B,EAAmCC,KAAnC,EAA0C;EACtC2B,EAAAA,OAAO,CAAC3B,KAAD,CAAP,CADsC;;EAEtCC,EAAAA,MAAM,CAACC,cAAP,CAAsBL,IAAtB,EAA4BE,GAA5B,EAAiC;EAC7B+B,IAAAA,GAD6B,iBACvB;EACF,aAAO9B,KAAP;EACH,KAH4B;EAI7B+B,IAAAA,GAJ6B,eAIzBC,QAJyB,EAIf;EACV,UAAIA,QAAQ,KAAKhC,KAAjB,EAAwB;EACpB;EACH;;EACD2B,MAAAA,OAAO,CAACK,QAAD,CAAP,CAJU;EAKV;;EACAhC,MAAAA,KAAK,GAAGgC,QAAR;EACH;EAX4B,GAAjC;EAcH;;;EAKM,SAASL,OAAT,CAAiB9B,IAAjB,EAAuB;EAC1B,MAAIoC,KAAK,GAAGrC,QAAQ,CAACC,IAAD,CAApB;;EACA,MAAI,CAACoC,KAAL,EAAY;EACR;EACH;EACD,SAAO,IAAIZ,QAAJ,CAAaxB,IAAb,CAAP,CAL0B;EAM7B;;ECrED;EACA;EACA;EACA;EAIO,SAASqC,SAAT,CAAmBC,EAAnB,EAAuB;EAC1B,MAAMC,IAAI,GAAGD,EAAE,CAACE,QAAhB,CAD0B;;EAG1B,MAAID,IAAI,CAACE,KAAT,EAAgB;;EAIhB,MAAIF,IAAI,CAAC1B,OAAT,EAAkB;;EAIlB,MAAI0B,IAAI,CAACvC,IAAT,EAAe;EACX0C,IAAAA,QAAQ,CAACJ,EAAD,CAAR;EACH;;EAED,MAAIC,IAAI,CAACI,QAAT,EAAmB;;EAInB,MAAIJ,IAAI,CAACK,KAAT,EAAgB;EAGnB;;EAMD,SAASF,QAAT,CAAkBJ,EAAlB,EAAsB;EAClB;EACA,MAAItC,IAAI,GAAGsC,EAAE,CAACE,QAAH,CAAYxC,IAAvB,CAFkB;EAGlB;;EACAA,EAAAA,IAAI,GAAG,OAAOA,IAAP,KAAgB,UAAhB,GAA6BA,IAAI,CAAC6C,IAAL,CAAUP,EAAV,CAA7B,GAA6CtC,IAApD,CAJkB;;EAOlBsC,EAAAA,EAAE,CAACQ,KAAH,GAAW9C,IAAX,CAPkB;EAUlB;EAEA;;EACA8B,EAAAA,OAAO,CAAC9B,IAAD,CAAP,CAbkB;EAerB;;EClDD;EACA;EACA;EAIO,SAAS+C,SAAT,CAAmBC,GAAnB,EAAwB;EAC3B;EACAA,EAAAA,GAAG,CAACtC,SAAJ,CAAcuC,KAAd,GAAsB,UAAUC,OAAV,EAAmB;EACrC;EACA,QAAMZ,EAAE,GAAG,IAAX,CAFqC;;EAGrCA,IAAAA,EAAE,CAACE,QAAH,GAAcU,OAAd,CAHqC;;EAMrCb,IAAAA,SAAS,CAACC,EAAD,CAAT,CANqC;EAOxC,GAPD;EAQH;;EChBD;EACA;EACA;EAIA;EACA;EACA;EACA;;EACA,SAASU,GAAT,CAAaE,OAAb,EAAsB;EAElB;EACA,OAAKD,KAAL,CAAWC,OAAX;EACH;;;EAGDH,SAAS,CAACC,GAAD,CAAT;;;;;;;;"}